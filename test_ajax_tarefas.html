<!DOCTYPE html>
<html>
<head>
    <title>Teste AJAX Tarefas</title>
    <meta name="csrf-token" content="test-token">
</head>
<body>
    <h1>Teste AJAX - Tarefas por Status</h1>

    <button onclick="testarAjax(1, 'nao_iniciada')">Teste Não Iniciada</button>
    <button onclick="testarAjax(1, 'em_andamento')">Teste Em Andamento</button>
    <button onclick="testarAjax(1, 'atrasada')">Teste Atrasada</button>
    <button onclick="testarAjax(1, 'concluida')">Teste Concluída</button>

    <div id="resultado"></div>

    <script>
        function testarAjax(userId, status) {
            const url = `http://127.0.0.1:8000/dashboard/tarefas_por_status?user_id=${userId}&status=${status}`;

            console.log('Testando URL:', url);

            fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text(); // Usar text() primeiro para ver o que vem
            })
            .then(data => {
                console.log('Resposta recebida:', data);
                document.getElementById('resultado').innerHTML = `
                    <h3>Status: ${status}</h3>
                    <pre>${data}</pre>
                `;

                // Tentar fazer parse JSON
                try {
                    const jsonData = JSON.parse(data);
                    console.log('JSON parseado:', jsonData);
                } catch (e) {
                    console.error('Erro ao parsear JSON:', e);
                }
            })
            .catch(error => {
                console.error('Erro na requisição:', error);
                document.getElementById('resultado').innerHTML = `
                    <h3>Erro:</h3>
                    <pre>${error.message}</pre>
                `;
            });
        }
    </script>
</body>
</html>
