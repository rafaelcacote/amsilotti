<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Carregamento de Campos</title>
    <style>
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            display: none;
        }
        .section.visible {
            display: block;
            background-color: #f8f9fa;
        }
        .debug-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste de Carregamento de Campos</h1>

        <div class="form-group">
            <label for="tipo">Tipo do Im√≥vel:</label>
            <select id="tipo" name="tipo" onchange="handleTipoChange()">
                <option value="">Selecione o tipo</option>
                <option value="terreno">üåø Terreno</option>
                <option value="apartamento">üè¢ Apartamento</option>
                <option value="casa">üè† Casa</option>
                <option value="galpao">üè≠ Galp√£o</option>
                <option value="sala_comercial">üè¢ Sala Comercial</option>
            </select>
        </div>

        <div id="loading-container" style="display: none;">
            <p>‚è≥ Carregando formul√°rio...</p>
        </div>

        <div id="tipo-badge-container" style="display: none;">
            <p><strong>Tipo selecionado:</strong> <span id="tipo-badge-text"></span></p>
        </div>

        <div id="fator-fundamentacao-container" style="display: none;" class="form-group">
            <label for="fator_fundamentacao">Fator de Fundamenta√ß√£o:</label>
            <select id="fator_fundamentacao" name="fator_fundamentacao">
                <option value="">Selecione</option>
                <option value="Grau I">Grau I</option>
                <option value="Grau II">Grau II</option>
                <option value="Grau III">Grau III</option>
            </select>
        </div>

        <!-- Se√ß√µes do formul√°rio -->
        <div id="endereco-imovel" class="section">
            <h3>üìç Endere√ßo do Im√≥vel</h3>
            <input type="text" placeholder="Endere√ßo..." name="endereco">
        </div>

        <div id="dados-terreno" class="section">
            <h3>üåø Dados do Terreno</h3>
            <input type="text" placeholder="√Årea total..." name="area_total_dados_terreno">
            <select name="benfeitoria_terreno">
                <option value="">Benfeitoria</option>
                <option value="Possui">Possui</option>
                <option value="N√£o Possui">N√£o Possui</option>
            </select>
        </div>

        <div id="dados-construcao" class="section">
            <h3>üèóÔ∏è Dados da Constru√ß√£o</h3>
            <input type="text" placeholder="√Årea constru√≠da..." name="area_construida">
            <select name="benfeitoria">
                <option value="">Benfeitoria</option>
                <option value="possui">Possui</option>
                <option value="nao possui">N√£o Possui</option>
            </select>
        </div>

        <div id="dados-economicos" class="section">
            <h3>üí∞ Dados Econ√¥micos</h3>
            <input type="text" placeholder="Valor do im√≥vel..." name="valor_total_imovel">
        </div>

        <div id="fonte-informacao" class="section">
            <h3>‚ÑπÔ∏è Fonte de Informa√ß√£o</h3>
            <input type="text" placeholder="Fonte..." name="fonte_informacao">
        </div>

        <div id="upload-section" class="section">
            <h3>üì∑ Upload de Imagens</h3>
            <input type="file" multiple>
        </div>

        <div id="botoes-acao" class="section">
            <h3>‚ö° A√ß√µes</h3>
            <button type="button">Salvar</button>
            <button type="button">Cancelar</button>
        </div>

        <div id="debug-area" class="debug-area">
            <strong>Debug Log:</strong>
        </div>
    </div>

    <script>
        // Labels dos tipos
        const tipoLabels = {
            'apartamento': 'üè¢ Apartamento',
            'casa': 'üè† Casa',
            'galpao': 'üè≠ Galp√£o',
            'sala_comercial': 'üè¢ Sala Comercial',
            'terreno': 'üåø Terreno'
        };

        function debugLog(message) {
            const debugArea = document.getElementById('debug-area');
            const timestamp = new Date().toLocaleTimeString();
            debugArea.innerHTML += `\n[${timestamp}] ${message}`;
            console.log(message);
        }

        // Fun√ß√£o principal para mudan√ßa de tipo
        function handleTipoChange() {
            const tipo = document.getElementById('tipo').value;
            debugLog(`handleTipoChange chamada com tipo: "${tipo}"`);

            if (!tipo) {
                hideAllSections();
                clearFormFields();
                return;
            }

            // Limpa os campos quando troca de tipo
            clearFormFields();

            // Mostra o campo Fator de Fundamenta√ß√£o imediatamente
            showTypeBadge(tipo);

            // Mostra loading para as outras se√ß√µes
            showLoading(tipo);

            // Simula carregamento para as outras se√ß√µes
            setTimeout(() => {
                hideLoading();
                showFormSections(tipo);
            }, 300);
        }

        function showLoading(tipo) {
            const loadingContainer = document.getElementById('loading-container');

            debugLog(`Mostrando loading para tipo: ${tipo}`);

            // Oculta todas as se√ß√µes primeiro
            hideAllFormSections();

            loadingContainer.style.display = 'block';
        }

        function hideAllFormSections() {
            debugLog('Ocultando todas as se√ß√µes');

            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
                section.classList.remove('visible');
            });
        }

        function hideLoading() {
            const loadingContainer = document.getElementById('loading-container');
            loadingContainer.style.display = 'none';
            debugLog('Loading ocultado');
        }

        function showTypeBadge(tipo) {
            const badgeContainer = document.getElementById('tipo-badge-container');
            const badgeText = document.getElementById('tipo-badge-text');
            const fatorContainer = document.getElementById('fator-fundamentacao-container');

            badgeText.textContent = tipoLabels[tipo];
            badgeContainer.style.display = 'block';

            fatorContainer.style.display = 'block';

            debugLog(`Badge e fator de fundamenta√ß√£o mostrados para: ${tipo}`);
        }

        function hideAllSections() {
            debugLog('Ocultando todas as se√ß√µes e containers');

            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
                section.classList.remove('visible');
            });

            document.getElementById('tipo-badge-container').style.display = 'none';
            document.getElementById('fator-fundamentacao-container').style.display = 'none';
            document.getElementById('loading-container').style.display = 'none';
        }

        function showFormSections(tipo) {
            debugLog(`showFormSections chamada com tipo: ${tipo}`);

            // Define quais se√ß√µes devem aparecer para cada tipo
            const sectionsToShow = ['endereco-imovel', 'dados-economicos', 'fonte-informacao', 'upload-section', 'botoes-acao'];

            // Adiciona se√ß√µes espec√≠ficas baseado no tipo
            if (tipo === 'terreno') {
                sectionsToShow.push('dados-terreno');
                debugLog('Adicionando dados-terreno para terreno');
            } else {
                sectionsToShow.push('dados-construcao');
                debugLog(`Adicionando dados-construcao para ${tipo}`);
            }

            debugLog(`Se√ß√µes que ser√£o mostradas: ${sectionsToShow.join(', ')}`);

            // Mostra apenas as se√ß√µes necess√°rias
            sectionsToShow.forEach((sectionId, index) => {
                const section = document.getElementById(sectionId);
                if (section) {
                    setTimeout(() => {
                        section.style.display = 'block';
                        section.classList.add('visible');
                        debugLog(`Se√ß√£o mostrada: ${sectionId}`);
                    }, index * 100);
                } else {
                    debugLog(`ERRO: Se√ß√£o n√£o encontrada: ${sectionId}`);
                }
            });
        }

        function clearFormFields() {
            debugLog('Limpando campos do formul√°rio');

            // Limpa todos os campos de input
            const inputs = document.querySelectorAll('input:not([type="hidden"])');
            inputs.forEach(input => {
                if (input.type !== 'file') {
                    input.value = '';
                }
            });

            // Limpa todos os selects exceto o tipo
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                if (select.id !== 'tipo') {
                    select.value = '';
                }
            });
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM carregado, inicializando...');

            const tipoSelect = document.getElementById('tipo');

            // Se j√° tem um valor, mostra o formul√°rio
            if (tipoSelect.value) {
                debugLog(`Valor inicial encontrado: ${tipoSelect.value}`);
                handleTipoChange();
            } else {
                debugLog('Nenhum valor inicial, ocultando se√ß√µes');
                hideAllSections();
            }
        });
    </script>
</body>
</html>
